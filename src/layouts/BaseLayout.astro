---
import "../styles/global.css";
import AnimatedGradientBackground from "../components/AnimatedGradientBackground.astro";
import BackgroundGlow from "../components/BackgroundGlow.astro";
// import ThemeToggle from "../components/ThemeToggle";

interface Props {
  title?: string;
}

const { title = "Bryce Kennedy – Portfolio" } = Astro.props;
const base = import.meta.env.BASE_URL;
---

<html lang="en" class="dark">
  <head>
    <meta charset="utf-8" />
    <title>{title}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href={`${base}favicon.svg`} />
    <style>
      @view-transition {
        navigation: auto;
      }

      /* Header - sticky, initially hidden above viewport */
      .site-header {
        position: sticky;
        top: 0;
        z-index: 40;
        background: rgba(7, 10, 20, 0.95);
        backdrop-filter: blur(6px);
        border-bottom: 1px solid rgba(55, 65, 81, 0.2);
        transform: translateY(-100%);
        transition: transform 0.3s ease;
      }

      /* Header visible when scrolled past hero */
      .site-header.header--visible {
        transform: translateY(0);
      }

      .header-inner {
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
      }

      .header-profile {
        width: 2.5rem;
        height: 2.5rem;
      }

      .header-profile img {
        display: block;
      }

      .header-name {
        display: none;
      }

      @media (min-width: 768px) {
        .header-name {
          display: inline;
        }
      }

      /* Hero slot styling */
      ::slotted([slot="hero"]) {
        display: block;
        width: 100%;
      }
    </style>
  </head>
  <body class="min-h-screen bg-surface-dark text-text-light">
    <AnimatedGradientBackground />
    /* <BackgroundGlow /> */
    <div class="min-h-screen flex flex-col">
      <header
        class="site-header border-b border-gray-dark/70 bg-surface-dark/90 backdrop-blur transition-all"
      >
        <div class="max-w-5xl mx-auto px-4 header-inner">
          <div
            class="topbar flex items-center justify-between gap-4 py-6 md:py-4"
          >
            <div class="flex items-center gap-4">
              <a
                href={base}
                class="flex items-center gap-3 font-semibold tracking-tight"
              >
                <div
                  class="header-profile w-10 h-10 md:w-12 md:h-12 rounded-full overflow-hidden border-2 border-brand-orange"
                >
                  <img
                    src={`${base}images/profile-small.jpg`}
                    alt="Bryce Kennedy"
                    class="w-full h-full object-cover"
                  />
                </div>
                <div>
                  <p
                    class="text-xs uppercase tracking-[0.25em] text-sky-300/80 hidden md:block"
                    style="font-size:.6rem;"
                  >
                    UX Engineering · Frontend Development · Content Management Systems
                  </p>
                  <span class="header-name hidden md:inline">Bryce Kennedy</span
                  >
                </div>
              </a>
            </div>

            <nav class="flex items-center gap-4 text-sm header-nav">
              <a
                href="#projects"
                class="hover:text-brand-orange transition-colors">Projects</a
              >
              <a href="#about" class="hover:text-brand-orange transition-colors"
                >About</a
              >
            </nav>
          </div>
        </div>
      </header>

      <!-- Hero section from page -->
      <slot name="hero" />

      <main class="flex-1">
        <slot />
      </main>

      <footer class="border-t border-gray-dark/70 py-4 text-xs text-text-muted">
        <div class="max-w-5xl mx-auto px-4 flex justify-between items-center">
          <span>© {new Date().getFullYear()} Bryce Kennedy</span>

          <span class="flex items-center gap-3">
            <span class="text-text-muted mr-1">Built with</span>

            <a
              href="https://astro.build"
              target="_blank"
              rel="noopener noreferrer"
              class="text-text-muted hover:text-brand-orange transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange focus-visible:ring-offset-2 focus-visible:ring-offset-surface-dark"
              aria-label="Astro"
              title="Astro"
            >
              <!-- Inline Astro SVG (from public/icons/astro-svgrepo-com.svg) -->
              <svg
                class="w-6 h-6"
                viewBox="0 0 32 32"
                xmlns="http://www.w3.org/2000/svg"
                role="img"
                aria-hidden="true"
              >
                <path
                  d="M5.9,18.847a7.507,7.507,0,0,0-.572,2.624,3.265,3.265,0,0,0,.551,1.553,7.427,7.427,0,0,0,2.093,1.681L13.1,28.119A7.332,7.332,0,0,0,15.2,29.287a3.239,3.239,0,0,0,1.5,0,7.381,7.381,0,0,0,2.117-1.16L24,24.711a7.512,7.512,0,0,0,2.117-1.688,3.241,3.241,0,0,0,.55-1.563,7.515,7.515,0,0,0-.587-2.643L21.547,4.551a3.973,3.973,0,0,0-.54-1.3,1.733,1.733,0,0,0-.7-.51,3.972,3.972,0,0,0-1.4-.122H13.005a3.932,3.932,0,0,0-1.4.125,1.713,1.713,0,0,0-.7.512,3.94,3.94,0,0,0-.535,1.3L5.9,18.848Zm13.24-13.2a3.329,3.329,0,0,1,.441,1.093l3.892,12.784a16.168,16.168,0,0,0-4.653-1.573L16.291,9.391a.331.331,0,0,0-.513-.169.323.323,0,0,0-.119.169l-2.5,8.557a16.14,16.14,0,0,0-4.674,1.579L12.393,6.743a3.281,3.281,0,0,1,.442-1.094,1.458,1.458,0,0,1,.582-.43,3.31,3.31,0,0,1,1.175-.1h2.793a3.314,3.314,0,0,1,1.176.1,1.454,1.454,0,0,1,.583.432ZM16.127,21.06a5.551,5.551,0,0,0,3.4-.923,2.8,2.8,0,0,1-.207,2.182A3.938,3.938,0,0,1,17.773,23.8c-.674.428-1.254.8-1.254,1.787a2.079,2.079,0,0,0,.209.914,2.49,2.49,0,0,1-1.535-2.3v-.061c0-.683,0-1.524-.962-1.524a1.028,1.028,0,0,0-.391.077,1.021,1.021,0,0,0-.552.551,1.03,1.03,0,0,0-.079.391,3.769,3.769,0,0,1-.988-2.644,4.206,4.206,0,0,1,.175-1.248c.4.757,1.92,1.32,3.731,1.32Z"
                  fill="currentColor"></path>
              </svg>
            </a>

            <a
              href="https://react.dev"
              target="_blank"
              rel="noopener noreferrer"
              class="text-text-muted hover:text-brand-orange transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange focus-visible:ring-offset-2 focus-visible:ring-offset-surface-dark"
              aria-label="React"
              title="React"
            >
              <svg
                class="w-6 h-6"
                viewBox="0 0 841.9 595.3"
                xmlns="http://www.w3.org/2000/svg"
                fill="currentColor"
                aria-hidden="true"
              >
                <g>
                  <circle cx="420.9" cy="296.5" r="45.7"></circle>
                  <path
                    d="M520.5 78.1c-29.3 8-70.6 20.6-112.8 36.7 16 1.6 32.1 4.3 47.8 8.1 13.5 3.4 27 7.9 40 13.5 7.4 3.4 14.5-1 16.8-8.7 2.4-7.7-1.8-16-11.8-23.6z"
                  ></path>
                </g>
              </svg>
            </a>

            <a
              href="https://rive.app"
              target="_blank"
              rel="noopener noreferrer"
              class="text-text-muted hover:text-brand-orange transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange focus-visible:ring-offset-2 focus-visible:ring-offset-surface-dark"
              aria-label="Rive"
              title="Rive"
            >
              <svg
                class="w-6 h-6"
                viewBox="0 0 24 24"
                fill="currentColor"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <path
                  d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12zm6.5-1.2c.3-.8 1-1.3 1.8-1.3h4.4c.9 0 1.6.6 1.9 1.4.3.8.1 1.7-.5 2.3L12.8 17.9c-.6.6-1.6.6-2.2 0l-3.4-3.4c-.6-.6-.7-1.6-.2-2.4z"
                ></path>
              </svg>
            </a>
          </span>
        </div>
      </footer>
    </div>

    <script>
      // Wait for DOM to be fully loaded before initializing
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initScrollListener);
      } else {
        initScrollListener();
      }

      function initScrollListener() {
        const header = document.querySelector(".site-header");

        if (!header) {
          console.error("Header element not found");
          return;
        }

        console.log("Header initialized for scroll detection");

        // Find the hero section by id (section with id="test" in index.astro)
        const heroElement =
          document.querySelector('[slot="hero"]') ||
          document.querySelector("section#test");

        // If there's no hero section, always show the header
        if (!heroElement) {
          header.classList.add("header--visible");
          console.log("No hero section found - header always visible");
          return;
        }

        let ticking = false;

        const updateHeaderVisibility = () => {
          if (heroElement) {
            const heroRect = heroElement.getBoundingClientRect();
            const shouldShowHeader = heroRect.bottom < 0;

            console.log(
              "Hero bottom:",
              heroRect.bottom,
              "Should show header:",
              shouldShowHeader,
            );

            // Only update if state changed
            const hasClass = header.classList.contains("header--visible");
            if (shouldShowHeader !== hasClass) {
              header.classList.toggle("header--visible", shouldShowHeader);
              console.log(
                "Header class toggled. Has header--visible:",
                header.classList.contains("header--visible"),
              );
            }
          }
          ticking = false;
        };

        window.addEventListener(
          "scroll",
          () => {
            if (!ticking) {
              window.requestAnimationFrame(updateHeaderVisibility);
              ticking = true;
            }
          },
          { passive: true },
        );

        // Initial call
        updateHeaderVisibility();
      }

      // Smooth scroll with offset
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
          const href = anchor.getAttribute("href");
          if (href && href !== "#") {
            e.preventDefault();
            const target = document.querySelector(href);
            if (target) {
              const headerOffset = 80;
              const elementPosition = target.getBoundingClientRect().top;
              const offsetPosition =
                elementPosition + window.pageYOffset - headerOffset;

              window.scrollTo({
                top: offsetPosition,
                behavior: "smooth",
              });
            }
          }
        });
      });
    </script>
  </body>
</html>
